{"version": 1, "kubernetesObjects": [ {"kind": "Role", "apiVersion": "rbac.authorization.k8s.io/v1", "metadata": {"namespace": "default", "name": "run-ci-workload", "labels": {"name": "run-ci-workload", "app": "drone", "env": "production", "purpose": "infra"}}, "rules": [{"apiGroups": [""], "resources": ["secrets"], "verbs": ["create", "delete", "get"]}, {"apiGroups": [""], "resources": ["pods", "pods/log"], "verbs": ["get", "create", "delete", "list", "watch", "update"]}]}, {"apiVersion": "v1", "kind": "ServiceAccount", "metadata": {"name": "drone", "labels": {"name": "drone", "app": "drone", "env": "production", "purpose": "infra"}}}, {"kind": "RoleBinding", "apiVersion": "rbac.authorization.k8s.io/v1", "metadata": {"name": "ci-runner-drone", "labels": {"name": "ci-runner-drone", "app": "drone", "env": "production", "purpose": "infra"}}, "subjects": [{"kind": "ServiceAccount", "name": "drone"}], "roleRef": {"kind": "Role", "name": "run-ci-workload", "apiGroup": "rbac.authorization.k8s.io"}}, {"apiVersion": "apps/v1", "kind": "Deployment", "metadata": {"name": "drone-k8s-runner", "labels": {"name": "drone-k8s-runner", "app": "drone", "env": "production", "purpose": "infra"}}, "spec": {"replicas": 1, "selector": {"matchLabels": {"name": "drone-k8s-runner"}}, "template": {"metadata": {"labels": {"name": "drone-k8s-runner", "app": "drone", "env": "production", "purpose": "infra"}}, "spec": {"serviceAccountName": "drone", "containers": [{"name": "main", "image": "docker.io/drone/drone-runner-kube:1.0.0-beta.4", "ports": [{"containerPort": 3000}], "env": [{"name": "DRONE_RPC_HOST", "value": "drone-server"}, {"name": "DRONE_RPC_PROTO", "value": "http"}, {"name": "DRONE_RPC_SECRET", "valueFrom": {"secretKeyRef": {"name": "drone-rpc-shared", "key": "secret"}}}, {"name": "DRONE_RUNNER_CAPACITY", "value": "3"}, {"name": "DRONE_RUNNER_PRIVILEGED_IMAGES", "value": "plugins/docker"}, {"name": "DRONE_SECRET_PLUGIN_ENDPOINT", "value": "http://localhost:3000"}, {"name": "DRONE_SECRET_PLUGIN_TOKEN", "valueFrom": {"secretKeyRef": {"name": "drone-secret-shared", "key": "secret"}}}]}, {"name": "secrets-plugin", "image": "docker.io/drone/kubernetes-secrets:latest", "ports": [{"containerPort": 3000}], "env": [{"name": "SECRET_KEY", "valueFrom": {"secretKeyRef": {"name": "drone-secret-shared", "key": "secret"}}}]}]}}}}]}




